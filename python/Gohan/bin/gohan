#!/usr/bin/env python
# encoding: utf-8
#
# gohan
#
# Created by José Sánchez-Gallego on 22 Apr 2017.


from __future__ import division
from __future__ import print_function
from __future__ import absolute_import

import click
import warnings

from Gohan.exceptions import GohanUserWarning


@click.group()
def gohan():
    """Performs task related to MaNGa plate design."""
    pass


@gohan.command()
@click.argument('platerun', type=str)
@click.argument('platedata', type=str)
def design(platerun, platedata):
    """Designs a platerun.

    Requieres specifying a PLATERUN and the location of the PLATEDATA file
    that contains the list of plates to run.

    """

    from Gohan.scripts.generate_designs import generate_designs

    generate_designs(platerun, platedata)


@gohan.group()
def cmm():
    """Handles CMM files."""
    pass


@cmm.command()
@click.argument('PATH', type=str)
@click.option('--remote', is_flag=True, help='uses the tunnel connection to the DB')
def load(path, remote):
    """Checks PATH and loads CMM files to the DB. PATH can be a directory,
    that will be checked recursively for files not already loaded, or the
    path for a single CMM file.

    """
    print(remote)
    from Gohan.scripts.update_cmm import update_cmm

    if remote:
        warnings.warn('using tunnel connection to apodb. Did you create the tunnel?',
                      GohanUserWarning)

    update_cmm(path, remote=remote)


if __name__ == '__main__':
    gohan()
